<section class="section admin section__lot--show">
  <h2>Lote: <%= @lot.batch_code %></h2>

  <%= render 'shared/errors', { obj: @lot } %>
  <%= render partial: "shared/image", locals: { obj: @lot } %>

  <dl class="description__list">
    <div>
      <dt>Data de início:</dt>
      <dd><%= l(@lot.start_date, format: :long) %></dd>
    </div>

    <div>
      <dt>Data de encerramento:</dt>
      <dd><%= l(@lot.end_date, format: :long) %></dd>
    </div>

    <div>
      <dt>Status:</dt>
      <dd><%= t("activerecord.attributes.lot.status.#{@lot.status}") %></dd>
    </div>

    <div>
      <dt>Criado por:</dt>
      <dd><%= @lot.user.name %></dd>
    </div>

    <div>
      <dt>Aprovado por:</dt>
      <dd><%= @lot.approved_by&.name || "Esse lote ainda não foi aprovado" %></dd>
    </div>

    <% if @lot.status == "ended" %>
      <div class="lot__controls">
        <%= button_to "Validar Resultado", ended_lot_path(status: :finished), method: :post, class: "btn btn-success" %>
        <%= button_to "Cancelar Lote", ended_lot_path(status: :canceled), method: :post, class: "btn btn-danger" %>
      </div>
    <% elsif @lot.status == "finished" %>
      <div>
        <dt>Vencedor:</dt>
        <dd><%= @lot.bids.last&.user&.name || "Não houve nenhum lance." %></dd>
      </div>
    <% end %>

    <% if @lot.product_models.empty? %>
      <%= link_to "Adicionar Produtos", manage_lot_path(@lot), class: "btn btn-primary" %>
    <% end %>
  </dl>
</section>

<section class="section admin section__lot--show">
  <h2>Produtos contidos neste lote:</h2>

  <% if @lot.product_models.empty? %>
    <p>Não há produtos neste lote.</p>
  <% end %>

  <%= render partial: "shared/card-list", locals: { products: @lot.product_models } %>
</section>
